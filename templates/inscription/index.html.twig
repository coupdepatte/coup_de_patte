{% extends 'base.html.twig' %}

{% block title %}Inscription - Coup de Patte{% endblock %}

{% block stylesheets %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
{% endblock %}

{% block body %}
{% include 'commun/nav.html.twig' %}
<main>
    <div class="container">
        <div class="py-5 text-center">
            <img class="d-block mx-auto mb-4" src="{{asset('images/png-clipart-paw-dog-printing-paws-animals-monochrome.png')}}" alt="" width="72" height="57">
            <h2>Formulaire d'inscription</h2>
            <p class="lead">Veuillez remplir tout les champs affin de procéder à votre inscription sur le Site!</p>
        </div>
        <div class="row">
            <div class="col-md-7 col-lg-8 mx-auto" >
                <h4 class="mb-3 text-center">INSCRIPTION</h4>
                {% for message in app.flashes('success') %} 
                    {{ message|raw}}
                {% endfor %}
                {{form_start(form_inscription)}}
                    <div class="row g-3">
                        <div class="col-sm-6">
                            <label for="lastName" class="form-label"></label>
                            {{form_row(form_inscription.nomUtilisateur)}}
                                <div class="invalid-feedback">
                                Nom valide demandé.
                                </div>
                        </div>
                        <div class="col-sm-6">
                            <label for="firstName" class="form-label"></label>
                            {{form_row(form_inscription.prenomUtilisateur)}}
                                <div class="invalid-feedback">
                                Prénomm valide demandé.
                                </div>
                        </div>
                        <div class="col-sm-6">
                            <label for="pseudo" class="form-label"</label>
                            {{form_row(form_inscription.pseudoUtilisateur)}}
                                <div class="invalid-feedback">
                                Pseudo valide demandé.
                                </div>
                        </div>
                        <div class="col-sm-6">
                            <label for="email" class="form-label"</label>
                            {{form_row(form_inscription.loginUtilisateur)}}
                                <div class="invalid-feedback">
                                Email valide demandé.
                                </div>
                        </div>
                            <div class="col-sm-6">
                            <label for="floatingPassword" class="form-label"</label>
                            {{form_row(form_inscription.mdpUtilisateur)}}
                                <div class="invalid-feedback">
                                Mot de passe valide demandé.
                                </div>
                        </div>
                        <div class="col-12">
                            <label for="adresse" class="form-label"</label>
                            {{form_row(form_inscription.adressse)}}
                                <div class="invalid-feedback">
                                Adresse valide demandé.
                                </div>
                        </div>
                        </div>
                            <div class="col-12">
                            <label for="city" class="form-label"</label>
                            {{form_row(form_inscription.codeVille)}}
                                <div class="invalid-feedback">
                                Code Postal valide demandé.
                                </div>
                        </div>
                            <div class="col-12">
                            <label for="city" class="form-label"</label>
                            {{form_row(form_inscription.nomLieu)}}
                                <div class="invalid-feedback">
                                Ville valide demandé.
                                </div>
                        </div>
                            <div class="col-12">
                            <label for="city" class="form-label"</label>
                            {{form_row(form_inscription.departement)}}
                                <div class="invalid-feedback">
                                Departement valide demandé.
                                </div>
                        </div>
                            <div class="visually-hidden col-12">
                            <label for="city" class="form-label"</label>
                            {{form_row(form_inscription.longitudeAdresse)}}
                                <div class="invalid-feedback">
                                Adresse valide demandé.
                                </div>
                        </div >
                        <div class="visually-hidden col-12">
                            <label for="city" class="form-label"</label>
                            {{form_row(form_inscription.latitudeAdresse)}}
                                <div class="invalid-feedback">
                                Adresse valide demandé.
                                </div>
                        </div>
                        <div class="visually-hidden col-12">
                            <label for="city" class="form-label"</label>
                            {{form_row(form_inscription.codeInsee)}}
                                <div class="invalid-feedback">
                                Adresse valide demandé.
                                </div>
                        </div>
                        <hr class="my-4">
                            {{form_row(form_inscription.save)}}
                        {{form_end(form_inscription)}}
                </div>
            </div>
        </div>
    </div>
</main>
{% include 'commun/footer.html.twig' %}

{% endblock %}
{% block javascripts %}
<script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js" integrity="sha256-xLD7nhI62fcsEZK2/v8LsBcb4lG7dgULkuXoXB/j91c=" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.0/dist/sweetalert2.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script>
<script>
$("#inscription_adressse").autocomplete({
    source: function (request, response) {
        $.ajax({
            url: "https://api-adresse.data.gouv.fr/search/?q="+$("input[name='inscription[idLieu]']").val(),
            data: { q: request.term },
            dataType: "json",
            success: function (data) {
                var cities = [];
                var postcodes = [];
                var citycodes = [];
                response($.map(data.features, function (item) {
                    return { label: item.properties.name + " - " + item.properties.postcode + " - " + item.properties.city,
                        city: item.properties.city,
                        postcode: item.properties.postcode,
                        citycode: item.properties.citycode,
                        value: item.properties.name,
                        longitude: item.geometry.coordinates[0],
                        latitude: item.geometry.coordinates[1],
                        };
                    
                }));
            }
        });
    },
     // On remplit aussi le CP et ville
     select: function(event, ui) {

        $('#inscription_nomLieu').val(ui.item.city);
        $('#inscription_codeVille').val(ui.item.postcode);
        $('#inscription_codeInsee').val(ui.item.citycode);
        $('#inscription_longitudeAdresse').val(ui.item.longitude);
        $('#inscription_latitudeAdresse').val(ui.item.latitude);
        
    },
});

            $("#inscription_nomLieu").autocomplete({
    source: function (request, response) {
        $.ajax({
            url: "https://api-adresse.data.gouv.fr/search/?q="+$("input[name='inscription[idLieu]']").val(),
            data: { q: request.term },
            dataType: "json",
            success: function (data) {
                var postcodes = [];
                response($.map(data.features, function (item) {
                    // Ici on est obligé d'ajouter les CP dans un array pour ne pas avoir plusieurs fois le même
                    if ($.inArray(item.properties.postcode, postcodes) == -1) {
                        postcodes.push(item.properties.postcode);
                        return { label: item.properties.postcode + " - " + item.properties.city, 
                                city: item.properties.city,
                                value: item.properties.postcode,
                        };
                    }
                }));
            }
        });
    },
    
});
</script>
{% endblock %}